#include <windows.h> 
#include <stdio.h> 
#include <tchar.h>
#include <string.h>
#include <wchar.h>


typedef enum { false, true } bool;

HHOOK mouseHook;
HANDLE thread;
static char v1;
DWORD start;

void check_under()
{
	bool IsUnderVM = false;
	__asm {
		xor    eax, eax
		inc    eax
		cpuid
		bt     ecx, 0x1f
		jc     UnderVM
		NotUnderVM :
		jmp     NopInstr
			UnderVM :
		mov    IsUnderVM, 0x1
			NopInstr :
			nop
	}
	if (IsUnderVM == true) {
		printf("%s", "detected!\n");
	}
	else
	{
		printf("%s", "All good\n");
	}
}


void main() {
	
	char str1[20];
	//Checks if the thread handle is set. if it is, stop thread, else start.
	check_under();
	
	
	printf("Program running!");
	scanf_s("%s", str1, sizeof(str1));
}