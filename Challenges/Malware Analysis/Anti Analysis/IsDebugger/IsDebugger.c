#include <windows.h> 
#include <stdio.h> 
#include <tchar.h>
#include <string.h>
#include <wchar.h>


typedef enum { false, true } bool;

HHOOK mouseHook;
HANDLE thread;
static char v1;
DWORD start;

VOID WINAPI tls_callback1(
	PVOID DllHandle,
	DWORD Reason,
	PVOID Reserved)
{
	char try = "debugged";
	__asm {
		mov eax, fs:[30h]
		mov al, [eax + 2h]
		mov v1, al
	}
	if (v1 == 1)
	{
		ExitProcess(0);
	}
}
// TLS defines
#ifdef _M_IX86
#pragma comment (linker, "/INCLUDE:__tls_used")
#pragma comment (linker, "/INCLUDE:_p_tls_callback1")
#pragma data_seg(push)
#pragma data_seg(".CRT$XLAAA")
EXTERN_C PIMAGE_TLS_CALLBACK p_tls_callback1 = tls_callback1;
#pragma data_seg(".CRT$XLAAB")
#pragma data_seg(pop)
#endif

DWORD WINAPI MessageBoxThread() {
	MessageBox(NULL, "Hello world!", "Hello World!", NULL);
	return 0;
}

void main() {
	printf("Program running!");
	MessageBoxThread();
}